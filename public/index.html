<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GIRA Y GANA CON DRAGONS CASINO</title>

<meta property="og:image" content="https://iili.io/fdBAkvV.jpg">
<meta property="og:title" content="üé∞ GIRA Y GANA CON DRAGONS CASINO">
<meta property="og:description" content="Gir√° la rueda y descubr√≠ tu premio.">

<style>
body {
  margin:0; padding:0;
  font-family: Arial, sans-serif;
  background:url('https://iili.io/KyL5Hba.md.jpg') no-repeat center center fixed;
  background-size:cover;
  color:#fff; text-align:center;
}
#logoPrincipal { width:260px; margin:20px auto; filter:drop-shadow(0 0 12px #ff00ff); }
h1 { font-size:1.8rem; color:#ffcc00; text-shadow:0 0 10px #ff00ff,0 0 20px #00ffff; }
.wheel-container{ position:relative; width:320px; margin:auto; }
.rgb-ring{
  position:absolute; top:-12px; left:-12px; width:344px; height:344px;
  border-radius:50%; 
  background:conic-gradient(#ff0000,#ff9900,#ffff00,#00ff00,#00ffff,#0066ff,#9900ff,#ff00ff,#ff0000);
  animation:rgbSpin 4s linear infinite;
  filter:blur(6px) brightness(1.8); z-index:-1;
}
@keyframes rgbSpin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
#wheelCanvas{ width:100%; border-radius:50%; }
.indicator{
  position:absolute; top:-35px; left:50%; transform:translateX(-50%);
  width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;
  border-top:25px solid yellow; filter:drop-shadow(0 0 5px #ff0);
}
#spinButton{
  margin-top:20px;background:#ff0000;color:#fff;font-size:1.5rem;padding:15px 40px;
  border:none;border-radius:12px;cursor:pointer;
  box-shadow:0 0 20px #ff00ff,0 0 40px #ff00ff;
}
#popup{
  position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);
  display:none;justify-content:center;align-items:center;z-index:9999;
}
#popupContent{
  background:#222;padding:20px;border-radius:15px;max-width:90%;
  box-shadow:0 0 20px #ffcc00;text-align:center;
}
#contactoDereck{ font-size:1.1rem;color:#00ffea;font-weight:bold; }
#btnWhatsapp{
  margin-top:10px;background:#25D366;color:#fff;border:none;font-size:1.2rem;
  padding:10px 25px;border-radius:50px;cursor:pointer;display:inline-flex;gap:8px;
}
</style>
</head>

<body>

<img id="logoPrincipal" src="https://iili.io/fdBAkvV.jpg">

<h1>üéâ GIRA Y GANA CON DRAGONS CASINO üéÅ</h1>

<div class="wheel-container">
  <div class="rgb-ring"></div>
  <div class="indicator"></div>
  <canvas id="wheelCanvas" width="300" height="300"></canvas>
</div>

<button id="spinButton">GIRAR</button>

<div id="popup">
  <div id="popupContent">
    <h2>¬°GANASTE! üéâ</h2>
    <p id="premioTexto"></p>
    <p id="extraTexto"></p>

    <button id="solicitarBtn">Solicitar premio</button><br>
    <button id="closePopup">Cerrar</button>

    <p id="contactoDereck">üìû Contacto: 11 3617-2027 (Dereck)</p>

    <button id="btnWhatsapp">
      <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" width="24">
      Contactar por WhatsApp
    </button>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
const premios = [
  "10% extra (en la primera carga)",
  "15% extra (en la primera carga)",
  "20% extra (en la primera carga)",
  "30% extra (en la segunda carga)",
  "100 fichas (sin carga, no retirables)",
  "500 fichas (sin carga, no retirables)",
  "300 fichas (sin carga, no retirables)"
];

// GENERAR ID DE USUARIO
if(!localStorage.getItem("usuarioId")){
  localStorage.setItem("usuarioId","user_"+Math.random().toString(36).substring(2));
}
const usuarioId = localStorage.getItem("usuarioId");

const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");

const spinButton = document.getElementById("spinButton");
const popup = document.getElementById("popup");
const premioTexto = document.getElementById("premioTexto");
const extraTexto = document.getElementById("extraTexto");
const solicitarBtn = document.getElementById("solicitarBtn");
const closePopup = document.getElementById("closePopup");
const btnWhatsapp = document.getElementById("btnWhatsapp");

let currentAngle = 0;
const numSegments = premios.length;
const anglePerSegment = (2*Math.PI)/numSegments;

function drawWheel(){
  const colors=["#ff0000","#ff9900","#ffff00","#00ff00","#00ccff","#0066ff","#9900ff"];
  for(let i=0;i<numSegments;i++){
    ctx.beginPath();
    ctx.moveTo(150,150);
    ctx.arc(150,150,150,i*anglePerSegment,(i+1)*anglePerSegment);
    ctx.fillStyle=colors[i%colors.length];
    ctx.fill();
    ctx.stroke();
  }
}
drawWheel();

function showPopup(msg, premio=""){
  if(!msg) confetti({ particleCount:200, spread:80, origin:{y:0.6} });

  premioTexto.innerText = msg || `FELICIDADES üéâ Ganaste: ${premio}`;
  extraTexto.innerText = msg ? "" : "Record√° volver en 24 hs para volver a girar";

  popup.style.display="flex";

  solicitarBtn.style.display = msg ? "none" : "inline-block";

  solicitarBtn.onclick = () => {
      const fecha=new Date().toLocaleString();
      const mensaje=`hola dereck! Gane ${premio} (${fecha}) y quisiera solicitarlo. Gracias!`;
      window.open(`https://wa.me/5491136172027?text=${encodeURIComponent(mensaje)}`,"_blank");
  };

  btnWhatsapp.onclick = () => {
      window.open(`https://wa.me/5491136172027`,"_blank");
  };
}

function spinWheel(){
  fetch("https://gira-dragons-backend.onrender.com/girar", {  /* URL CORRECTA */
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ usuarioId })
  })
  .then(res=>res.json())
  .then(data=>{

    if(data.yaGiro){
      showPopup(data.mensaje);
      return;
    }

    const spinTime=4000;
    const spinAngle=Math.random()*360+1800;
    const startAngle=currentAngle;
    const targetAngle=startAngle+spinAngle;
    const startTime=performance.now();

    function animate(time){
      let elapsed=time-startTime;
      if(elapsed<spinTime){
        const progress=elapsed/spinTime;
        currentAngle=startAngle+(spinAngle*(1-Math.pow(1-progress,3)));
        drawRotatedWheel(currentAngle);
        requestAnimationFrame(animate);
      } else {
        currentAngle=targetAngle;
        drawRotatedWheel(currentAngle);
        showPopup(null,data.premio);
      }
    }
    requestAnimationFrame(animate);
  });
}

function drawRotatedWheel(angle){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(150,150);
  ctx.rotate(angle*Math.PI/180);
  ctx.translate(-150,-150);
  drawWheel();
  ctx.restore();
}

spinButton.onclick = spinWheel;
closePopup.onclick = ()=> popup.style.display="none";

</script>
</body>
</html>
